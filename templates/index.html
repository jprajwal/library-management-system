{% extends "base.html" %}
{%load static%}
{% block styles %}
<link rel="stylesheet" href="{%static 'styles/styles.css'%}">
{% endblock %}
{% block body %}
{% block scripts %}
{% endblock %}
<div id="lms-body" class="flex-container">
        <div id="books-view">
                <ul id="books-list">
                {% for book in books %}
                        <li>
                                <div id="book-info-container">
                                        <img id="book-image" src="{%static 'images/heading-image.jpg'%}", alt="book-image">
                                        <div id="book-info">
                                                <h2 id="book-title">{{book.title}}</h2>
                                                <p id="book-description">{{book.authors}}</p>  
                                        </div>
                                </div>
                                {% if user.is_authenticated %}
                                <div id="book-actions-container">
                                        <input type="button" value="add to cart" onClick="addToCart(this, {{book.id}})">
                                </div>
                                {% endif %}
                        </li>
                {% endfor %}
                </ul>
        </div>
        <div id="message-console"></div>
        <div id="actions-view">
                <div id="actions">
                        <form method="POST" action="/library/books/search">
                                {% csrf_token %}
                                <label for="searchby">Search by:</label>
                                <select id="searchby" name="searchby">
                                        <option value="author">Book author</option>
                                        <option value="title">Book title</option>
                                </select>
                                <input type="text" placeholder="search" name="search-text">
                                <input type="submit" value="search">
                        </form>
                        <form method="GET" action="/library/books/checkout">
                                <input id="checkout-button" type="submit" value="checkout">
                        </form>
                </div>
        </div>
</div>
<script src="{% static '/js/utils.js' %}"></script>
<script>
        function addToCart(element, bookid) {
                const csrftoken = getCookie("csrftoken");
                console.log(`csrf token: ${csrftoken}`);
                fetch(
                        "/library/cart/book",
                        {
                                "method": "POST",
                                "body": JSON.stringify({
                                        "book-id": bookid,
                                }),
                                "headers": {
                                        "X-CSRFToken": csrftoken,
                                        "Content-Type": "applicaiton/json",

                                },
                        }
                ).then((resp) => {
                        console.log(resp.ok); 
                        if (!resp.ok) {
                                resp.text().then((body) => {
                                        document.getElementById("message-console").innerHTML = body;
                                });
                                return;
                        }
                        document.getElementById("message-console").innerHTML += `<br> bookid=${bookid} added`;
                }).catch((err) => {
                        console.error(err);
                }); 
        }
</script>
{% endblock %}
